<!DOCTYPE html>
<html>
<head>
    <title>è›‹ç™½è´¨å¯è§†åŒ–å·¥å…· - 1E6B</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/3Dmol/2.1.0/3Dmol-min.js"></script>
    <style>
        :root {
            --primary: #2196F3;
            --secondary: #4CAF50;
            --background: #f8f9fa;
        }

        body {
            margin: 0;
            padding: 20px;
            font-family: 'Arial', sans-serif;
            background: var(--background);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        #viewer3d {
            width: 100%;
            height: 600px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            background: white;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            overflow: hidden;   
        }

        .controls {
            margin-top: 20px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 12px;
        }

        button {
            padding: 12px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        button:hover {
            background: #1976D2;
            transform: scale(1.02);
        }

        button.active {
            background: var(--secondary);
            box-shadow: 0 2px 8px rgba(76,175,80,0.3);
        }

        .status-bar {
            margin-top: 15px;
            padding: 10px;
            background: white;
            border-radius: 6px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .annotation-panel {
            position: absolute;
            top: 16px;
            right: 16px;
            background: rgba(255,255,255,0.95);
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            padding: 16px 18px 12px 18px;
            font-size: 12px;
            color: #222;
            max-width: 250px;
            z-index: 10;
            line-height: 1.7;
        }
        .annotation-panel ul {
            margin: 8px 0 0 0;
            padding-left: 18px;
        }
        .annotation-panel li {
            margin-bottom: 6px;
        }
        .annotation-panel strong {
            font-size: 16px;
            color: #1976D2;
        }


        /* åº•éƒ¨æ°´å°æ ·å¼ */
        .footer-watermark {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            padding: 15px 0;
            background: white;
            margin-top: 20px;
            border-top: 1px solid #eee;
        }

        .watermark-content {
            display: flex;
            align-items: center;
            gap: 20px;
            max-width: 800px;
            width: 100%;
            justify-content: center;
        }
            

        .logo-container {
            margin-right: 0;  /* ç§»é™¤åŸæœ‰å³è¾¹è· */
            width: 70px;  /* å›ºå®šå®¹å™¨å°ºå¯¸ */
            height: 70px;
            padding: 5px;  /* å†…è¾¹è·ä¿æŠ¤å›¾æ ‡ */
            background: rgba(255,255,255,0.9);  /* åŠé€æ˜ç™½åº• */
            border-radius: 8px;  /* åœ†è§’åŒ¹é…UIé£æ ¼ */
        }

        .logo-container img {
            width: 100%;  /* å……æ»¡å®¹å™¨ */
            height: 100%;
            object-fit: contain;  /* ç­‰æ¯”ä¾‹é€‚é… */
        }
            


        .text-container {
            text-align: center;
            font-size: 14px;
            color: #555;
            line-height: 1.5;
        }

        .text-container div:first-child {
            font-weight: bold;
            font-size: 16px;
            color: #2196F3;
            margin-bottom: 4px;
        }
        
    </style>
</head>
<body>
    <div class="container">
        <h1>è›‹ç™½è´¨å¯è§†åŒ–å·¥å…· - 1E6B</h1>

        
        <div id="viewer3d">
            <div class="annotation-panel" id="annotation-panel">
                <!-- æ³¨é‡Šä¿¡æ¯å°†ç”±JSåŠ¨æ€å¡«å…… -->
            </div>
        </div>
        
        <div class="controls">
            <div class="controls">
                <!-- æ–°å¢æ¨¡å‹é€‰æ‹©ä¸‹æ‹‰èœå• -->
                <select id="modelSelector" onchange="loadSelectedModel()" title="é€‰æ‹©è¦æŸ¥çœ‹çš„è›‹ç™½è´¨æ¨¡å‹">
                    <option value="1e6b">1E6B - åŸºç¡€æ¨¡å‹</option>
                    <option value="4ins">4INS - èƒ°å²›ç´ ç±»ä¼¼ç‰©</option>
                    <option value="7rsa_alpha1">7RSA Alphaèºæ—‹</option>
                    <option value="7rsa_beta146_betasheet">7RSA BetaæŠ˜å ç‰‡</option>
                    <option value="7rsa_loop2_loop">7RSA ç¯çŠ¶ç»“æ„</option>
                    <option value="7rsa_turn1_turn">7RSA è½¬è§’ç»“æ„</option>
                    <option value="my_structure">è‡ªå®šä¹‰ç»“æ„</option>
                </select>
            <button onclick="setDisplayMode('ribbon')">ğŸ—ï¸ é£˜å¸¦æ¨¡å‹</button>
            <button onclick="setDisplayMode('wireframe')">ğŸ”² çº¿æ£’æ¨¡å‹</button>
            <button onclick="setDisplayMode('ballstick')">âš¾ æ£’çƒæ£æ¨¡å‹</button>
            <button onclick="setDisplayMode('spacefill')">ğŸ”µ ç©ºé—´å¡«å……</button>
            <button onclick="setDisplayMode('surface')">ğŸŸ¢ è¡¨é¢å¡«å……</button>
            <button onclick="setDisplayMode('hydrophobic')">ğŸŒŠ äº²ç–æ°´åˆ†å¸ƒ</button>

            
        </div>

        <div class="status-bar" id="status">
            æ­£åœ¨åŠ è½½æ¨¡å‹...
        </div>
    </div>

    <script>
        // åˆå§‹åŒ–3DæŸ¥çœ‹å™¨
        const viewer = $3Dmol.createViewer("viewer3d", {
            background: "#ffffff",
            defaultcolors: $3Dmol.elementColors.JMol
        });

        // æ˜¾ç¤ºæ¨¡å¼é…ç½®
        const displayModes = {
            ribbon: {
                style: { 
                    cartoon: { 
                        colorfunc: function(atom) {
                            // æŒ‰æ®‹åŸºåŒºé—´åˆ†è‰²
                            const colorBlocks = [
                                {start: 1, end: 40, color: '#55aa7f'},   // ç»¿è‰²
                                {start: 41, end: 80, color: '#d2b777'},  // é»„è‰²
                                {start: 81, end: 120, color: '#ff8b8d'}, // ç²‰è‰²
                                {start: 121, end: 160, color: '#af8aff'},// ç´«è‰²
                                {start: 161, end: 9999, color: '#55aaff'}// ç°è“
                            ];
                            const resi = atom.resi;
                            for (let block of colorBlocks) {
                                if (resi >= block.start && resi <= block.end) return block.color;
                            }
                            return '#B0B8C1';
                        },
                        thickness: 0.6,
                        arrows: true
                    }
                },
                label: "é£˜å¸¦æ¨¡å‹"
            },
            wireframe: {
                style: { 
                    stick: { radius: 0.12 },
                    sphere: { radius: 0, opacity: 0 }
                },
                label: "çº¿æ£’æ¨¡å‹"
            },
            ballstick: {
                style: { 
                    stick: { radius: 0.12 },
                    sphere: { radius: 0.32, opacity: 0.9 }
                },
                label: "æ£’çƒæ£æ¨¡å‹"
            },
            spacefill: {
                style: { sphere: { scale: 0.6 } },
                surface: { type: $3Dmol.SurfaceType.VDW, opts: { opacity: 0.85 } },
                label: "ç©ºé—´å¡«å……æ¨¡å‹"
            },
            surface: {
                style: {},
                surface: null, // ç”¨è‡ªå®šä¹‰é€»è¾‘
                label: "è¡¨é¢å¡«å……æ¨¡å‹"
            },
            hydrophobic: {
                style: (hydrophobic) => ({
                    [hydrophobic]: { sphere: { color: "#FFD700", scale: 0.6 } },
                    default: { sphere: { color: "#4169E1", scale: 0.6 } }
                }),
                surface: {
                    type: $3Dmol.SurfaceType.VDW,
                    opts: { 
                        opacity: 0.7,
                        colorfunc: (atom) => hydrophobicResidues.includes(atom.resn) ? "#FFD700" : "#4169E1"
                    }
                },
                label: "äº²ç–æ°´åˆ†å¸ƒ"
            },
            alpha: {
                style: { 
                    cartoon: { 
                        color: "#FF6B6B",
                        thickness: 1.2,
                        opacity: 0.9,
                        arrows: true,
                        ribbon: true,
                        smoothness: 1
                    }
                },
                label: "é˜¿å°”æ³•èºæ—‹",
                filter: (atom) => atom.ss === 'H' && atom.resi >= 5 && atom.resi <= 15 // ä»…æ˜¾ç¤º5-15å·æ®‹åŸºçš„Î±èºæ—‹
            },
            beta: {
                style: { 
                    cartoon: { 
                        color: "#4ECDC4",
                        thickness: 1.2,
                        opacity: 0.9,
                        arrows: true,
                        ribbon: true,
                        smoothness: 1
                    }
                },
                label: "è´å¡”æŠ˜å ",
                filter: (atom) => atom.ss === 'S'
            }
        };

        // å¸¸é‡å®šä¹‰
        const hydrophobicResidues = ["ALA","VAL","LEU","ILE","MET","PHE","TRP","PRO"];

        // æ³¨é‡Šä¿¡æ¯å­—å…¸
        const annotationDict = {
            ribbon: `<strong>é£˜å¸¦æ¨¡å‹ (Ribbon)</strong><br>
            <b>å®šä¹‰ï¼š</b>ç”¨æ‰å¹³é£˜å¸¦è¡¨ç¤ºè›‹ç™½è´¨äºŒçº§ç»“æ„ï¼ˆÎ±èºæ—‹ä¸ºèºæ—‹çŠ¶ï¼ŒÎ²æŠ˜å ä¸ºç®­å¤´ï¼‰ã€‚<br>
            <b>ç‰¹ç‚¹ï¼š</b>å¿½ç•¥åŸå­ç»†èŠ‚ï¼Œçªå‡ºè›‹ç™½è´¨éª¨æ¶çš„æŠ˜å æ¨¡å¼ï¼Œå¸¸ç”¨é¢œè‰²åŒºåˆ†ä¸åŒç»“æ„åŸŸæˆ–é“¾ã€‚`,
            wireframe: `<strong>çº¿æ£’æ¨¡å‹ (Wireframe)</strong><br>
            <b>å®šä¹‰ï¼š</b>ç”¨çº¿æ¡è¡¨ç¤ºåŒ–å­¦é”®ï¼ŒåŸå­ç”¨çº¿æ¡çš„äº¤ç‚¹ï¼ˆèŠ‚ç‚¹ï¼‰è¡¨ç¤ºï¼Œä¸æ˜¾ç¤ºåŸå­å¤§å°ã€‚<br>
            <b>ç‰¹ç‚¹ï¼š</b>ç»“æ„ç®€æ´ï¼Œçªå‡ºåˆ†å­éª¨æ¶å’Œé”®çš„èµ°å‘ï¼Œä¸åŒºåˆ†åŸå­ç±»å‹ã€‚`,
            ballstick: `<strong>æ£’çƒæ£æ¨¡å‹ (Ball-and-stick)</strong><br>
            <b>å®šä¹‰ï¼š</b>åŸå­ç”¨å½©è‰²çƒä½“è¡¨ç¤ºï¼ˆä¸åŒé¢œè‰²å¯¹åº”ä¸åŒå…ƒç´ ï¼‰ï¼ŒåŒ–å­¦é”®ç”¨æ£çŠ¶è¿æ¥ã€‚<br>
            <b>ç‰¹ç‚¹ï¼š</b>ç›´è§‚æ˜¾ç¤ºåŸå­ç±»å‹ã€é”®é•¿å’Œé”®è§’ï¼Œå¹³è¡¡ç®€æ´æ€§ä¸ä¿¡æ¯é‡ã€‚`,
            spacefill: `<strong>ç©ºé—´å¡«å……æ¨¡å‹ (Space-filling)</strong><br>
            <b>å®šä¹‰ï¼š</b>åŸå­æŒ‰èŒƒå¾·ååŠå¾„æ¯”ä¾‹æ˜¾ç¤ºä¸ºçƒä½“ï¼Œé‡å éƒ¨åˆ†ä½“ç°åŸå­é—´æ¥è§¦ã€‚<br>
            <b>ç‰¹ç‚¹ï¼š</b>æœ€æ¥è¿‘åˆ†å­å®é™…ç©ºé—´å ä½çš„è¡¨ç°æ–¹å¼ï¼Œæ— æ³•ç›´æ¥è§‚å¯Ÿé”®çš„ç»†èŠ‚ã€‚`,
            surface: `<strong>è¡¨é¢å¡«å……æ¨¡å‹ (Surface)</strong><br>
            <b>å®šä¹‰ï¼š</b>é€šè¿‡ç”µå­å¯†åº¦ç­‰å€¼é¢æˆ–æº¶å‰‚å¯åŠè¡¨é¢ï¼ˆSAS/SESï¼‰æ„å»ºåˆ†å­è¡¨é¢ã€‚<br>
            <b>ç‰¹ç‚¹ï¼š</b>æ˜¾ç¤ºåˆ†å­è½®å»“å’Œè¡¨é¢ç‰¹å¾ï¼ˆå¦‚ç–æ°´/äº²æ°´åŒºåŸŸï¼‰ï¼Œå¸¸ç”¨é€æ˜æˆ–å½©è‰²æ˜ å°„ã€‚`,
            hydrophobic: `<strong>äº²ç–æ°´åˆ†å¸ƒæ¨¡å‹ (Hydrophobic)</strong><br>
            <b>å®šä¹‰ï¼š</b>é€šè¿‡é¢œè‰²æˆ–è¡¨é¢å±æ€§æ ‡è®°åˆ†å­çš„äº²æ°´ï¼ˆææ€§ï¼‰å’Œç–æ°´ï¼ˆéææ€§ï¼‰åŒºåŸŸã€‚<br>
            <b>ç‰¹ç‚¹ï¼š</b>ææ€§åŒºåŸŸå¸¸ç”¨è“è‰²è¡¨ç¤ºï¼Œç–æ°´åŒºåŸŸå¸¸ç”¨é»„è‰²è¡¨ç¤ºï¼Œå¯ç»“åˆè¡¨é¢æˆ–ç©ºé—´å¡«å……æ¨¡å‹å®ç°ã€‚`
        };

        // æ ¸å¿ƒæ˜¾ç¤ºå‡½æ•°
        async function setDisplayMode(mode) {
            viewer.removeAllSurfaces();
            viewer.setStyle({}, {});
            const config = displayModes[mode];
            if (!config) return;

            // åº”ç”¨ç»„åˆè¿‡æ»¤æ¡ä»¶
            viewer.setStyle({
                ...(config.filter ? { ss: config.filter } : {}),
                resi: { $between: [5, 15] } // ç²¾ç¡®é™å®šæ®‹åŸºèŒƒå›´
            }, config.style);
            if (mode === 'hydrophobic') {
                viewer.setStyle({ resn: hydrophobicResidues }, config.style(hydrophobicResidues)[hydrophobicResidues]);
                viewer.setStyle({ resn: { $not: hydrophobicResidues } }, config.style().default);
                viewer.addSurface(config.surface.type, config.surface.opts);
            } else if (mode === 'surface') {
                viewer.addSurface($3Dmol.SurfaceType.VDW, {
                    opacity: 0.92,
                    color: 'spectrum',
                    smooth: 16,
                    probeRadius: 2.2
                });
            } else {
                viewer.setStyle({}, config.style);
                if (config.surface) {
                    viewer.addSurface(config.surface.type, config.surface.opts);
                }
            }

            document.getElementById('status').textContent = `å½“å‰æ¨¡å¼ï¼š${config.label}`;
            document.querySelectorAll('button').forEach(btn => {
                btn.classList.toggle('active', btn.textContent.includes(config.label));
            });
            document.getElementById('annotation-panel').innerHTML = annotationDict[mode] || '';
            viewer.render();
        }

        // åŠ è½½æ¨¡å‹
        async function loadModel(modelName = '1e6b') {
            try {
                document.getElementById('status').innerHTML = `ğŸ”„ æ­£åœ¨åŠ è½½ ${modelName}...`;
                viewer.removeAllModels();  // æ¸…é™¤æ—§æ¨¡å‹
                
                const url = `https://suyecuni.github.io/BioStruct/models/${modelName}.pdb`;
                const response = await fetch(url);
                
                if (!response.ok) throw new Error(`HTTPé”™è¯¯ ${response.status}`);
                document.getElementById('status').innerHTML = "ğŸ” è§£ææ¨¡å‹æ•°æ®...";
                
                const data = await response.text();
                viewer.addModel(data, "pdb");
                setDisplayMode('ribbon'); // é»˜è®¤æ˜¾ç¤ºé£˜å¸¦æ¨¡å‹
                viewer.zoomTo();
                viewer.render();
                document.getElementById('status').textContent = "æ¨¡å‹åŠ è½½å®Œæˆ";

                return true;
            } catch (error) {
                document.getElementById('status').textContent = "æ¨¡å‹åŠ è½½å¤±è´¥ï¼š" + error.message;
                console.error(error);
                return false;
            }
        }

        // æ–°å¢é€‰æ‹©å™¨å¤„ç†å‡½æ•°
        function loadSelectedModel() {
            const selector = document.getElementById('modelSelector');
            const modelName = selector.value;
            loadModel(modelName);
        }

        // åˆå§‹åŒ–æ‰§è¡Œ
        loadModel();
        viewer.enableZoom(true);
        viewer.enablePan(true);

        // åˆå§‹åŒ–æ—¶é»˜è®¤æ˜¾ç¤ºribbonæ³¨é‡Š
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('annotation-panel').innerHTML = annotationDict['ribbon'];
        });
    </script>

    
</body>
</html>


<!-- åº•éƒ¨æ°´å°åŒºåŸŸ -->
<div class="footer-watermark">
    <div class="watermark-content">
        <div class="logo-container">
            <div class="logo">
                 <img src="images/logo.svg" alt="BioStruct Logo">
            </div>
        </div>
        <div class="text-container">
            <div>BioStruct å±•ç¤ºå¹³å°</div>
            <div>è¥¿å—å¤§å­¦ç”Ÿå‘½ç§‘å­¦å­¦é™¢ | åˆ¶ä½œï¼šå…°å©·ã€è°¢ä½³å®</div>
            <div>Â© Southwest University | Ting Lan, Jiahong Xie</div>
        </div>
    </div> 
</div>
